<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.scent.perfume.product.model.mapper.ProductMapper">


	<resultMap id="productListResultMap" type="Product">
		<id property="pno" column="P_NO"/>
		<result property="PMno" column="PM_NO"/>
		<result property="brand" column="P_BRAND"/>
		<result property="title" column="P_TITLE"/>
		<result property="name" column="P_NAME"/>
		<result property="eng" column="P_ENG"/>
		<result property="price" column="P_PRICE"/>
		<result property="date" column="P_DATE"/>
		<result property="status" column="P_STATUS"/>
		<result property="gender" column="P_GENDER"/>
		<result property="detail" column="P_DETAIL"/>
		<collection property="option" javaType="List" columnPrefix="O_" resultMap="optionResultMap"/>
		<collection property="midcate" javaType="MidCate" columnPrefix="PM_" resultMap="midcateResultMap"/>
		<collection property="topcate" javaType="TopCate" columnPrefix="PT_" resultMap="topcateResultMap"/>
		<collection property="benefit" javaType="List" columnPrefix="B_" resultMap="benefitResultMap"/>
		<collection property="productbenefit" javaType="List" columnPrefix="PB_" resultMap="productbenefitResultMap"/>
	</resultMap>

	<resultMap id="benefitResultMap" type="PBenefit">
		<id property="bnno" column="BN_NO"/>
		<result property="bnname" column="BN_NAME"/>
		<result property="bntitle" column="BN_TITLE"/>
		<result property="bncontent" column="BN_CONTENT"/>
		<result property="bncreatedate" column="BN_CREATEDATE"/>
		<result property="bnenddate" column="BN_ENDDATE"/>
		<result property="bnratio" column="BN_RATIO"/>
		<result property="bnstatus" column="BN_STATUS"/>
		<result property="bnhit" column="BN_HIT"/>
	</resultMap>
	
	
	

	<resultMap id="productbenefitResultMap" type="ProductBenefit">
		<id property="Pbfno" column="PBF_NO"/>
		<result property="bnno" column="BN_NO"/>
		<result property="pno" column="P_NO"/>
	</resultMap>


	<resultMap id="brandResultMap" type="Product">
		<id property="pno" column="P_NO"/>
		<result property="brand" column="P_BRAND"/>
	</resultMap>



	<resultMap id="optionResultMap" type="Option">
		<id property="pono" column="PO_NO"/>
		<result property="pno" column="P_NO"/>
		<result property="poname" column="PO_NAME"/>
		<result property="poprice" column="PO_PRICE"/>
		<result property="poamount" column="PO_AMOUNT"/>
	</resultMap>

	<resultMap id="topcateResultMap" type="TopCate">
		<id property="ptno" column="PT_NO"/>
		<result property="ptname" column="PT_NAME"/>
		<result property="ptdetail" column="PT_DETAIL"/>
	</resultMap>

	<resultMap id="midcateResultMap" type="MidCate">
		<id property="pmno" column="PM_NO"/>
		<result property="pmname" column="PM_NAME"/>
		<result property="pmcno" column="PM_C_NO"/>
		<result property="ptno" column="PT_NO"/>
	</resultMap>



	<select id="selectProductByNo" parameterType="_int"  resultMap="productListResultMap">
			SELECT P.P_NO,
                   P.PM_NO,
                   P.P_BRAND,
                   P.P_TITLE,
                   P.P_NAME,
                   P.P_ENG,
                   P.P_DETAIL,
                   P.P_STATUS,
                   P.P_GENDER,
                   P.P_PRICE,
                   P.P_DATE,
                   P.P_UPDATE,
                   O.PO_NO AS O_PO_NO,
			       O.P_NO AS O_P_NO,
			       O.PO_NAME AS O_PO_NAME,
			       O.PO_PRICE AS O_PO_PRICE,
			       O.PO_AMOUNT AS O_PO_AMOUNT
			FROM PRODUCT_OPTION O
			LEFT OUTER JOIN PRODUCT P ON (P.P_NO = O.P_NO)
			WHERE P.P_NO = #{no}
	</select>






	<select id="selelctTopCateCount" resultType="_int">
		SELECT COUNT(*) FROM
		PRODUCT_TOPCATEGORY
	</select>

	<select id="selectAllTopCate" resultMap="topcateResultMap">
		SELECT PT_NO,
		       PT_NAME,
		       PT_DETAIL
		FROM
		PRODUCT_TOPCATEGORY
	</select>
	


	 



	<select id="selectProductByPtNo" parameterType="_int" resultMap="productListResultMap">
		SELECT P.P_NO,
		       P.PM_NO,
		       PM.PM_NO AS PM_PM_NO,
		       PM.PT_NO AS PM_PT_NO,
		       P.P_BRAND, 
		       P.P_TITLE, 
		       P.P_NAME, 
		       P.P_ENG, 
		       P.P_GENDER, 
		       P.P_PRICE, 
		       PT.PT_NO AS PT_PT_NO, 
		       PT.PT_NAME AS PT_PT_NAME, 
		       PT.PT_DETAIL AS PT_PT_DETAIL
		FROM
		PRODUCT P 
		LEFT OUTER JOIN PRODUCT_MIDCATEGORY PM ON (P.PM_NO = PM.PM_NO)
		LEFT OUTER JOIN PRODUCT_TOPCATEGORY PT ON (PM.PT_NO = PT.PT_NO)
        WHERE PT.PT_NO = #{no}
	</select>


	<select id="selectScentProductCountByNo"  parameterType="_int"  resultType="_int">
		SELECT COUNT(*)
		FROM
		PRODUCT P 
		LEFT OUTER JOIN PRODUCT_MIDCATEGORY PM ON (P.PM_NO = PM.PM_NO)
		LEFT OUTER JOIN PRODUCT_TOPCATEGORY PT ON (PM.PT_NO = PT.PT_NO)
        WHERE PT.PT_NO = #{no} 
	</select>

	<select id="selectScentProductByNo"  parameterType="_int" resultMap="productListResultMap">
<!-- 		SELECT P.P_NO, -->
<!-- 		       P.PM_NO, -->
<!-- 		       PM.PM_NO AS PM_PM_NO, -->
<!-- 		       PM.PT_NO AS PM_PT_NO, -->
<!-- 		       P.P_BRAND,  -->
<!-- 		       P.P_TITLE,  -->
<!-- 		       P.P_NAME,  -->
<!-- 		       P.P_ENG,  -->
<!-- 		       P.P_GENDER,  -->
<!-- 		       P.P_PRICE,  -->
<!-- 		       PT.PT_NO AS PT_PT_NO,  -->
<!-- 		       PT.PT_NAME AS PT_PT_NAME,  -->
<!-- 		       PT.PT_DETAIL AS PT_PT_DETAIL -->
<!-- 		FROM -->
<!-- 		PRODUCT P  -->
<!-- 		LEFT OUTER JOIN PRODUCT_MIDCATEGORY PM ON (P.PM_NO = PM.PM_NO) -->
<!-- 		LEFT OUTER JOIN PRODUCT_TOPCATEGORY PT ON (PM.PT_NO = PT.PT_NO) -->
<!--         WHERE PT.PT_NO = #{no} -->
		
			SELECT     P.P_NO,
		 		       P.PM_NO, 
		 		       PM.PM_NAME AS PM_PM_NAME, 
				       P.P_BRAND,  
				       P.P_TITLE,  
				       P.P_NAME,  
		 		       P.P_ENG,  
		 		       P.P_GENDER,  
		 		       P.P_PRICE,
		               B.BN_NAME AS B_BN_NAME,
		               B.BN_RATIO AS B_BN_RATIO,
		               B.BN_STATUS AS B_BN_STATUS,
		               PT.PT_NO AS PT_PT_NO,
		               PT.PT_NAME AS PT_PT_NAME,
		               PT.PT_DETAIL AS PT_PT_DETAIL
		    FROM 
		    PRODUCT P
		    LEFT OUTER JOIN PRODUCT_MIDCATEGORY PM ON (P.PM_NO = PM.PM_NO)
		    LEFT OUTER JOIN PRODUCT_TOPCATEGORY PT ON (PM.PT_NO = PT.PT_NO)
		    LEFT OUTER JOIN PRODUCT_BENEFIT PB ON (P.P_NO = PB.P_NO)
		    LEFT OUTER JOIN BENEFIT B ON (PB.BN_NO = B.BN_NO)
		    WHERE PM.PM_C_NO = 1 AND
		    PT.PT_NO = #{no}
	</select>


	<select id="selectScentByNo" parameterType="_int" resultMap="topcateResultMap">
	
		SELECT * FROM 
        PRODUCT_TOPCATEGORY
        WHERE PT_NO = #{no}
	
	</select>



    <!-- 
	전체리스트 향수 (리스트)
	 -->
	<select id="selectAll" resultMap="productListResultMap">
<!-- 		SELECT P.P_NO, -->
<!-- 		       P.PM_NO, -->
<!-- 		       PM.PM_NO AS PM_PM_NO, -->
<!-- 		       PM.PT_NO AS PM_PT_NO, -->
<!-- 		       P.P_BRAND,  -->
<!-- 		       P.P_TITLE,  -->
<!-- 		       P.P_NAME,  -->
<!-- 		       P.P_ENG,  -->
<!-- 		       P.P_GENDER,  -->
<!-- 		       P.P_PRICE,  -->
<!-- 		       PT.PT_NO AS PT_PT_NO,  -->
<!-- 		       PT.PT_NAME AS PT_PT_NAME  -->
<!-- 		FROM -->
<!-- 		PRODUCT P  -->
<!-- 		LEFT OUTER JOIN PRODUCT_MIDCATEGORY PM ON (P.PM_NO = PM.PM_NO) -->
<!-- 		LEFT OUTER JOIN PRODUCT_TOPCATEGORY PT ON (PM.PT_NO = PT.PT_NO) -->
		
		
		
<!-- 		SELECT P.P_NO, -->
<!-- 		       P.PM_NO, -->
<!-- 		       PM.PM_NAME AS PM_PM_NAME, -->
<!-- 		       P.P_BRAND,  -->
<!-- 		       P.P_TITLE,  -->
<!-- 		       P.P_NAME,  -->
<!-- 		       P.P_ENG,  -->
<!-- 		       P.P_GENDER,  -->
<!-- 		       P.P_PRICE -->
<!--     FROM  -->
<!--     PRODUCT P -->
<!--     JOIN PRODUCT_MIDCATEGORY PM ON (P.PM_NO = PM.PM_NO) -->
<!--     WHERE PM.PM_C_NO = 1 -->
    
    
        SELECT 
               P.P_NO,
               PB.P_NO AS PB_P_NO,
               P.PM_NO, 
 		       PM.PM_NAME AS PM_PM_NAME,
		       P.P_BRAND,  
		       P.P_TITLE,  
		       P.P_NAME,  
 		       P.P_ENG,  
 		       P.P_GENDER,  
 		       P.P_PRICE,
 		       P.P_DATE,
               B.BN_STATUS AS B_BN_STATUS, 
               B.BN_ENDDATE AS B_BN_ENDDATE,     
               B.BN_NAME AS B_BN_NAME,
               B.BN_RATIO AS B_BN_RATIO
        FROM 
        PRODUCT P
        LEFT OUTER JOIN PRODUCT_MIDCATEGORY PM ON (P.PM_NO = PM.PM_NO)
        LEFT OUTER JOIN PRODUCT_BENEFIT PB ON (P.P_NO = PB.P_NO)
        LEFT OUTER JOIN BENEFIT B ON (PB.BN_NO = B.BN_NO)
        WHERE PM.PM_C_NO = 1  
        	<if test="keyword != null">
        		AND P.P_TITLE LIKE '%' || #{keyword} || '%'
        		OR  P.P_BRAND LIKE '%' || #{keyword} || '%'
        		OR  P.P_BRAND LIKE '%' || #{keyword} || '%'
        		OR  P.P_NAME LIKE '%' || #{keyword} || '%' 
        		OR  P.P_ENG LIKE '%' || #{keyword} || '%'
        	</if>
         <if test="gender != null">
        	AND P.P_GENDER = #{gender}
        </if>
         <if test="brand != null ">
         	AND P.P_BRAND = #{brand}
         </if>
         <if test="sort != null">
        	<choose>
				<when test='sort.equals("1")'>
					ORDER BY P.P_DATE DESC
				</when>
				<when test='sort.equals("2")'>
					ORDER BY P.P_PRICE ASC
				</when>
				<when test='sort.equals("3")'>
					ORDER BY P.P_PRICE DESC
				</when>
			</choose>
        </if>
        
        
        
	</select>


	<select id="selectProductCount" resultType="_int" >
		SELECT COUNT(*) FROM 
   		PRODUCT P
        JOIN PRODUCT_MIDCATEGORY PM ON (P.PM_NO = PM.PM_NO)
        WHERE PM.PM_C_NO = 1
        <if test="gender != null">
        	AND P.P_GENDER = #{gender}
        </if>
       
        
		
	</select>
	
	<select id="selectProductCountByGender" parameterType="string" resultType="_int">
		SELECT COUNT(*) FROM 
	    PRODUCT P
	    JOIN PRODUCT_MIDCATEGORY PM ON (P.PM_NO = PM.PM_NO)
	    WHERE PM.PM_C_NO = 1 AND
	    P.P_GENDER = #{gender}
	</select>
	
	<select id="selectProductByGender" parameterType="string" resultMap="productListResultMap">
		SELECT p.P_NO,
			   P.P_NAME,
	           P.P_BRAND,
	           P.P_TITLE,
	           P.P_ENG,
	           P.P_GENDER,
	           P.P_PRICE,
	           PM.PM_NAME
	    FROM 
	    PRODUCT P
	    JOIN PRODUCT_MIDCATEGORY PM ON (P.PM_NO = PM.PM_NO)
	    WHERE PM.PM_C_NO = 1 AND
	    P.P_GENDER = #{gender}
	</select>
	
	
	<select id="selectBrandList" resultMap="brandResultMap">
		SELECT DISTINCT P.P_BRAND
        FROM PRODUCT P
        JOIN PRODUCT_MIDCATEGORY PM ON (P.PM_NO = PM.PM_NO)
        WHERE PM.PM_C_NO = 1	
	</select>
	
</mapper>







